# AWS云安全架构知识体系分析

> 基于AWS官方文档深度提炼的9大专业术语领域、思维模型和评估标准

## 一、专业术语体系（9大领域）

### 1. 身份与访问管理（IAM）

**核心概念：**
- **Principal（主体）**：IAM用户、角色、联合身份
- **Authentication vs Authorization**：身份验证 vs 权限授权
- **Policy**：JSON格式权限文档（IAM Policy、Resource-Based Policy）
- **Role Chaining**：角色链式调用
- **MFA**：多因素认证
- **Permissions Boundary**：权限边界
- **IAM Access Analyzer**：未授权访问分析

**关键服务：**
- AWS IAM
- IAM Identity Center（原AWS SSO）
- AWS STS（Security Token Service）

---

### 2. 多账户治理

**核心概念：**
- **SCP（Service Control Policy）**：组织级权限边界
- **OU（Organizational Unit）**：账户分组
- **Control Tower**：自动化Landing Zone
- **Guardrails**：防护机制（预防性 vs 检测性）
- **Landing Zone**：登陆区（标准化多账户环境）

**关键服务：**
- AWS Organizations
- AWS Control Tower
- AWS Account Factory

---

### 3. 网络安全

**核心概念：**
- **VPC Peering**：VPC对等连接
- **Transit Gateway**：中转网关（中心辐射型架构）
- **Security Group vs NACL**：有状态 vs 无状态防火墙
- **VPC Endpoints**：私有连接到AWS服务（Interface vs Gateway）
- **Public Subnet vs Private Subnet**：公有 vs 私有子网
- **Bastion Host**：堡垒主机

**关键服务：**
- Amazon VPC
- AWS WAF（Web应用防火墙）
- AWS Shield（DDoS防护）
- AWS Firewall Manager

---

### 4. 威胁检测与响应

**核心概念：**
- **Findings**：安全发现（GuardDuty、Security Hub）
- **Attack Chain**：攻击链（Reconnaissance → Exploitation → Exfiltration）
- **Indicators of Compromise（IoC）**：侵袭指标
- **Dwell Time**：攻击者在系统中的停留时间
- **Blast Radius**：爆炸半径（安全事件影响范围）
- **MTTD/MTTR**：平均检测时间/平均响应时间

**关键服务：**
- Amazon GuardDuty（威胁检测）
- AWS Security Hub（安全聚合）
- Amazon Detective（根因分析）
- Amazon EventBridge（事件响应）

---

### 5. 日志与审计

**核心概念：**
- **Management Events**：管理事件（控制面操作）
- **Data Events**：数据事件（对象级操作）
- **Insights**：CloudTrail Insights异常检测
- **Immutable WORM**：一次写入多次读取（防篡改）
- **Audit Trail**：审计轨迹

**关键服务：**
- AWS CloudTrail（API调用日志）
- Amazon CloudWatch Logs（日志聚合）
- AWS Config（配置变更记录）
- AWS CloudTrail Lake（10年日志存储）

---

### 6. 合规框架

**核心标准：**
- **CIS AWS Foundations Benchmark**：基础安全基线（100+项检查）
- **NIST CSF**：识别、保护、检测、响应、恢复
- **PCI DSS**：支付卡行业数据安全标准（12项要求）
- **AWS FSBP**：AWS Foundational Security Best Practices
- **ISO 27001**：信息安全管理体系
- **SOC 2**：服务组织控制报告
- **HIPAA**：医疗数据隐私法
- **GDPR**：欧盟通用数据保护条例

**关键服务：**
- AWS Audit Manager
- AWS Artifact（合规文档）
- AWS Compliance Center

---

### 7. 数据保护

**核心概念：**
- **Encryption at Rest**：静态数据加密
- **Encryption in Transit**：传输中加密
- **KMS Key Management**：密钥管理（Customer Managed vs AWS Managed）
- **Envelope Encryption**：信封加密
- **PII**：个人身份信息
- **Data Classification**：数据分类（机密、内部、公开）

**关键服务：**
- AWS KMS（密钥管理）
- Amazon Macie（敏感数据发现）
- AWS CloudHSM（硬件安全模块）
- S3 Encryption（服务端加密）

---

### 8. 容器安全

**核心概念：**
- **Pod Security Policies**：Pod安全策略（已废弃，改用PSS）
- **Pod Security Standards**：Pod安全标准（Privileged、Baseline、Restricted）
- **Network Policies**：网络策略
- **Runtime Protection**：运行时保护
- **Image Scanning**：镜像扫描
- **IRSA**：IAM Roles for Service Accounts
- **Admission Controller**：准入控制（Validating vs Mutating）

**关键服务：**
- Amazon EKS（Elastic Kubernetes Service）
- Amazon ECR（Elastic Container Registry）
- EKS Add-ons（包括安全插件）

---

### 9. 云安全思维模型

**核心原则：**
1. **Shared Responsibility Model**：责任共担模型
   - AWS负责：云的安全性（Region、Edge、物理设施）
   - 客户负责：云中的安全性（数据、身份、操作系统配置）

2. **Defense in Depth**：纵深防御
   - 多层安全控制（网络层、应用层、数据层）
   - 预防性 + 检测性控制

3. **Least Privilege**：最小权限原则
   - 仅授予完成任务所需的最小权限
   - 定期审查和撤销未使用的权限

4. **Zero Trust**：零信任架构
   - 永不信任，始终验证
   - 显式验证（身份、设备、位置）

5. **Infrastructure as Code**：基础设施即代码
   - 使用Terraform/CloudFormation管理安全配置
   - GitOps工作流（所有变更通过PR审批）

6. **Secure by Default**：默认安全
   - 新资源自动应用安全配置
   - 使用SCP和Config Rules防止配置漂移

---

## 二、思维模型与评估框架

### AWS Well-Architected Security Pillar 七大原则

1. **Identity（身份）**：强身份验证
   - 实施MFA多因素认证
   - 使用IAM Roles而不是长期Access Keys
   - 集中管理身份（IAM Identity Center）

2. **Infrastructure Protection（基础设施保护）**：分层防护
   - VPC隔离
   - Security Group和NACL
   - WAF防护Web应用

3. **Data Protection（数据保护）**：分类和加密
   - 数据分类标签
   - 静态加密 + 传输加密
   - 密钥轮换

4. **Detection（检测）**：威胁检测和日志记录
   - 启用GuardDuty威胁检测
   - CloudTrail审计日志
   - Security Hub聚合发现

5. **Incident Response（事件响应）**：自动化响应
   - EventBridge自动化playbooks
   - 预定义响应流程
   - 定期演练

6. **Compliance（合规）**：合规性证明
   - 自动化合规检查
   - 审计报告
   - 持续监控

7. **Governance（治理）**：策略即代码
   - SCP组织级策略
   - Tag Policies标签治理
   - IaC版本控制

---

### 安全评估五步法

1. **需求分析**
   - 业务需求
   - 合规要求
   - 风险承受度

2. **现状评估**
   - 使用Trusted Advisor评估
   - Security Hub合规评分
   - GuardDuty威胁发现

3. **目标架构设计**
   - 多账户结构
   - 网络架构
   - IAM模型
   - 合规框架

4. **实施路线图**
   - 分阶段实施（基础 → 高级 → 优化）
   - 优先级排序（严重 → 高 → 中 → 低）
   - 里程碑设置

5. **持续改进**
   - 定期审计
   - CloudTrail日志分析
   - GuardDuty发现响应
   - 基于威胁情报调整策略

---

### 风险优先级矩阵

| 严重级别 | 修复时间 | 示例 |
|---------|---------|------|
| **严重（Critical）** | 立即修复（0-24小时） | 公开的S3 Bucket、根用户激活、活跃的挖矿恶意软件 |
| **高（High）** | 7天内修复 | 未加密的EBS卷、过宽的IAM策略（*:*）、未启用MFA的管理员 |
| **中（Medium）** | 30天内修复 | 缺少MFA、未启用CloudTrail、过期未轮换的Access Keys |
| **低（Low）** | 持续改进 | 优化成本、改进文档、标签规范、多因素认证覆盖不全 |

---

## 三、关键服务集成图

### 预防性控制（Preventive）
```
AWS Organizations (SCP)
    ↓
IAM (Permissions Boundary + MFA)
    ↓
VPC (Security Groups + NACLs)
    ↓
WAF (Web应用防火墙)
    ↓
KMS (加密)
```

### 检测性控制（Detective）
```
CloudTrail (审计日志)
    ↓
GuardDuty (威胁检测)
    ↓
Security Hub (聚合发现)
    ↓
Config (合规检查)
    ↓
Detective (根因分析)
```

### 响应性控制（Responsive）
```
EventBridge (事件总线)
    ↓
SSM Automation (自动化修复)
    ↓
Lambda (自定义逻辑)
    ↓
SNS (通知)
```

---

## 四、常见安全陷阱（避免这些错误）

❌ **永远不要做的事：**
1. 使用根用户进行日常操作
2. 将Security Group开放0.0.0.0/0到敏感端口（22/3306/3389）
3. 在IAM Policy中使用Hardcoded AWS Account ID
4. 忽略GuardDuty Findings
5. 禁用CloudTrail
6. 将Access Keys硬编码到代码中
7. 创建名为"PowerUserAccess"的通配策略
8. S3 Bucket关闭Block Public Access
9. EC2实例使用IMDSv1（存在SSRF漏洞）
10. 跳过定期安全审计

✅ **最佳实践清单：**
1. 启用MFA for all IAM users（特别是管理员）
2. 使用AWS Organizations和SCP实施集中治理
3. 启用GuardDuty和Security Hub in all regions
4. 使用IAM Roles而不是长期Access Keys
5. 加密所有EBS volumes、S3 buckets、RDS instances
6. 使用VPC Endpoints访问AWS服务（避免通过互联网）
7. 实施Infrastructure as Code（IaC）和GitOps
8. 定期轮换密钥和凭证（每90天）
9. 使用AWS Config进行持续合规检查
10. 实施自动化事件响应playbooks

---

## 五、学习资源推荐

### 官方文档
- AWS Security Reference Architecture: https://docs.aws.amazon.com/prescriptive-guidance/latest/security-reference-architecture/
- AWS Well-Architected Framework: https://docs.aws.amazon.com/wellarchitected/
- AWS Security Hub: https://docs.aws.amazon.com/securityhub/
- Amazon GuardDuty: https://docs.aws.amazon.com/guardduty/

### 认证考试
- **AWS Certified Security - Specialty（SAS-C01）**
  - 考试时长：170分钟
  - 题目数量：65题（多选/多响应）
  - 通过分数：750分
  - 有效期：3年

### 持续学习
- AWS Security Blog: https://aws.amazon.com/blogs/security/
- AWS re:Inforce（年度安全会议）
- AWS Security Bulletins（安全公告）

---

**文档版本**: v1.0
**最后更新**: 2025-01-19
**维护者**: CSA SOP Skill
